
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FTC Scouting Dashboard</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f4f8;
      color: #333;
    }
    header {
      background: #2563eb;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    main {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 20px;
    }
    .box {
      background: white;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }
    .box:hover {
      transform: translateY(-3px);
    }
    h2 {
      margin-top: 0;
      color: #2563eb;
      font-size: 20px;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 8px;
    }
    input, select, textarea, button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 15px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      box-sizing: border-box;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 5px rgba(37,99,235,0.3);
    }
    textarea {
      height: 90px;
      resize: vertical;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 14px;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #1e40af;
    }
    .result-card {
      background: #ffffff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      margin-top: 12px;
    }
    .result-card h3 {
      margin-top: 0;
      color: #2563eb;
    }
    .result-card ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .result-card li {
      padding: 6px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .result-card li:last-child {
      border-bottom: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f9fafb;
    }
  </style>
</head>
<body>

<header>FTC Scouting Dashboard</header>

<main>
  <!-- Sync Competition -->
  <div class="box">
    <h2>ðŸ“¡ Sync Competition</h2>
    <input id="eventCode" placeholder="Enter Event Code" />
    <button onclick="syncEvent()">Sync Event</button>
    <div id="eventSummary"></div>
  </div>

  <!-- Get Team Report -->
  <div class="box">
    <h2>ðŸ“„ Get Team Report</h2>
    <input id="team_number" placeholder="Enter Team Number" />
    <button onclick="getReport(team_number)">Get Report</button>
    <div id="TeamReport"></div>
  </div>

  <!-- My Team Info -->
  <div class="box">
    <h2>ðŸ¤– My Team Info</h2>
    <select id="my_shooting_range">
      <option value="">Select Shooting Range</option>
      <option value="near">Near</option>
      <option value="far">Far</option>
      <option value="mostly near">Mostly Near</option>
      <option value="mostly far">Mostly Far</option>
      <option value="varies">Varies</option>
    </select>
    <input id="my_robots_scored" type="number" placeholder="Robots Scored" />
    <input id="my_max_score_without_pattern" placeholder="Max Score Without Pattern (or unknown/untested)" />
    <input id="my_max_score_with_pattern" placeholder="Max Score With Pattern (or unknown/untested)" />
    <select id="my_needs_human_player">
      <option value="">Needs Human Player?</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
    <select id="my_has_lifting_for_parking">
      <option value="">Has Lifting for Parking?</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
    <textarea id="my_notes" placeholder="Additional Notes"></textarea>
    <button onclick="saveMyReport()">Save Description</button>
  </div>

  <!-- Other Team Report -->
  <div class="box">
    <h2>ðŸ›  Edit/Add Other Team Report</h2>
    <input id="other_team_id" placeholder="Team Number" />
    <select id="other_shooting_range">
      <option value="">Select Shooting Range</option>
      <option value="near">Near</option>
      <option value="far">Far</option>
      <option value="mostly near">Mostly Near</option>
      <option value="mostly far">Mostly Far</option>
      <option value="varies">Varies</option>
    </select>
    <input id="other_robots_scored" type="number" placeholder="Robots Scored" />
    <input id="other_max_score_without_pattern" placeholder="Max Score Without Pattern (or unknown/untested)" />
    <input id="other_max_score_with_pattern" placeholder="Max Score With Pattern (or unknown/untested)" />
    <select id="other_needs_human_player">
      <option value="">Needs Human Player?</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
    <select id="other_has_lifting_for_parking">
      <option value="">Has Lifting for Parking?</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
    <textarea id="other_notes" placeholder="Additional Notes"></textarea>
    <button onclick="saveOtherReport()">Save Report</button>
  </div>

  <!-- Compare Teams -->
  <div class="box">
    <h2>âš– Compare Teams</h2>
    <input id="compare_team" placeholder="Enter Team Number" />
    <button onclick="compareTeam()">Compare</button>
    <div id="compareResult"></div>
  </div>
</main>

<script>
const API = "http://0.0.0.0:8000";
const OUR_TEAM = 22360;

async function syncEvent() {
  const code = eventCode.value.trim();
  if (!code) return alert("Please enter an event code");

  eventSummary.innerHTML = "<p>Syncing...</p>";

  await fetch(`${API}/sync/event/${code}`, { method: "POST" });

  const summary = await fetch(`${API}/sync/event/${code}/summary`).then(r => r.json());

  eventSummary.innerHTML = `
    <div class="result-card">
      <h3>Event Summary</h3>
      <ul>
        <li><strong>Event Code:</strong> ${summary.event_code}</li>
        <li><strong>Teams:</strong> ${summary.teams}</li>
        <li><strong>Matches:</strong> ${summary.matches}</li>
        ${
          summary.next_match
            ? `<li><strong>Next Match:</strong> ${summary.next_match.match_key} @ ${summary.next_match.start_time}</li>`
            : `<li>No upcoming match</li>`
        }
      </ul>
    </div>
  `;
}

async function saveMyReport() {
  const data = {
    shooting_range: my_shooting_range.value,
    robots_scored: parseInt(my_robots_scored.value),
    max_score_without_pattern: my_max_score_without_pattern.value,
    max_score_with_pattern: my_max_score_with_pattern.value,
    needs_human_player: my_needs_human_player.value,
    has_lifting_for_parking: my_has_lifting_for_parking.value,
    notes: my_notes.value
  };

  await fetch(`${API}/reports/${OUR_TEAM}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  alert("Your team report has been saved");
}

async function saveOtherReport() {
  const team = other_team_id.value.trim();
  if (!team) return alert("Please enter a team number");

  const data = {
    shooting_range: other_shooting_range.value,
    robots_scored: parseInt(other_robots_scored.value),
    max_score_without_pattern: other_max_score_without_pattern.value,
    max_score_with_pattern: other_max_score_with_pattern.value,
    needs_human_player: other_needs_human_player.value,
    has_lifting_for_parking: other_has_lifting_for_parking.value,
    notes: other_notes.value
  };

  await fetch(`${API}/reports/${team}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  alert(`Report for team ${team} has been saved`);
}

async function getReport(team_id){
  team_id = team_id.value.trim();
  if(!team_id) return alert("Please enter a team number");

  const data = await fetch(`${API}/reports/${team_id}`).then(r => r.json());

  let html = `<div class="result-card"><h3>Team ${data.team_number} Report</h3><ul>`;
  for (const [key, value] of Object.entries(data)) {
    if (value && key !== "team_number") {
      html += `<li><strong>${key.replace(/_/g, ' ')}:</strong> ${value}</li>`;
    }
  }
  html += `</ul></div>`;
  TeamReport.innerHTML = html;
}

async function compareTeam() {
  const team = compare_team.value.trim();
  if (!team) return alert("Please enter a team number");

  const res = await fetch(`${API}/compare/${team}`).then(r => r.json());

  let breakdownTable = "<table><tr><th>Field</th><th>Score</th><th>Detail</th></tr>";
  for (const [key, val] of Object.entries(res.breakdown)) {
    breakdownTable += `<tr><td>${key}</td><td>${val.score ?? "-"}</td><td>${JSON.stringify(val.detail)}</td></tr>`;
  }
  breakdownTable += "</table>";

  let html = `
    <div class="result-card">
      <h3>Comparison Result</h3>
      <ul>
        <li><strong>Similarity Score:</strong> ${res.similarity_0_100}%</li>
      </ul>
      ${breakdownTable}
    </div>
  `;
  compareResult.innerHTML = html;
}
</script>

</body>
</html>
